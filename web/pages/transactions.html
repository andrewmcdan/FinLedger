<section class="page">
    <% const canJournalize = role === "manager" || role === "accountant"; const canViewJournalQueue = role === "manager" || role === "accountant"; const canApprove = role === "manager"; const canViewLedger = role === "administrator" || role === "manager" || role === "accountant"; %>
    <header class="page-header">
        <h1>Transactions</h1>
        <p><% if (role === "administrator") { %> Ledger access only. Journalizing and journal approval features are limited to manager and accountant roles. <% } else { %> Journalize entries, manage approval queue, and review posted ledger activity. <% } %></p>
    </header>

    <% if (!canJournalize && !canViewJournalQueue && !canViewLedger) { %>
    <section class="card">
        <h2>Access Restricted</h2>
        <p class="meta">Your role does not have access to journalizing, journal approvals, or ledger tools.</p>
    </section>
    <% } %> <% if (canJournalize) { %>
    <section class="card stack" aria-labelledby="journal_section_title">
        <h2 id="journal_section_title">Journal</h2>
        <p class="meta"><% if (role === "manager") { %> Create entries and manage journal workflow approvals. <% } else { %> Create, prepare, and submit journal entries for manager approval. <% } %></p>

        <form id="journal_entry_form" class="stack" autocomplete="off">
            <div class="grid">
                <div class="field">
                    <label for="journal_entry_date">Entry Date</label>
                    <input type="date" id="journal_entry_date" name="entry_date" />
                </div>
                <div class="field">
                    <label for="journal_type">Journal Type</label>
                    <select id="journal_type" name="journal_type">
                        <option value="general" selected>General</option>
                        <option value="adjusting">Adjusting</option>
                    </select>
                </div>
                <div class="field" data-journal-reference-field>
                    <label for="journal_reference">Reference</label>
                    <input type="text" id="journal_reference" name="reference" placeholder="Optional reference code" title="Reference Code will be generated if not provided." />
                    <p class="journal-reference-tip" data-journal-reference-tip role="status" aria-live="polite" aria-hidden="true">Not available</p>
                </div>
            </div>

            <div class="field">
                <label for="journal_entry_description">Description</label>
                <textarea id="journal_entry_description" name="description" rows="2" placeholder="Required: Describe the business event"></textarea>
            </div>

            <div class="field" data-journal-documents-container>
                <div class="data-row">
                    <p class="value">
                        <span class="span-label">Attached Documents</span>
                        <span class="span-actions">
                            <button type="button" class="button-small" id="journal_add_document_button" data-journal-add-document-button>Add Document</button>
                            <input type="file" id="journal_entry_document_input" name="journal_entry_documents" accept=".pdf,.doc,.docx,.xls,.xlsx,.csv,.jpg,.jpeg,.png,.txt" multiple hidden />
                        </span>
                    </p>
                </div>
                <ul class="journal-entry-documents-list" id="journal_entry_documents_list" data-journal-entry-documents-list>
                    <li class="meta" data-journal-entry-documents-empty>No documents attached. Documentation is required for all journal entries.</li>
                </ul>
            </div>

            <div class="data-row">
                <p class="value">
                    <span class="span-label page-navigation">Journal Lines (debits first, then credits)</span>
                    <span class="span-actions">
                        <button type="button" class="button-small" id="journal_add_line_button" data-add-line-button>Add Account Line</button>
                    </span>
                </p>
            </div>

            <div class="table-scroll">
                <table class="table table--wide" id="journal_lines_table">
                    <thead>
                        <tr>
                            <th>Line</th>
                            <th>Account</th>
                            <th>Line Description</th>
                            <th>Debit</th>
                            <th>Credit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody data-journal-lines>
                        
                    </tbody>
                </table>
            </div>

            <div class="grid">
                <article class="notice">Debits: <strong data-journal-total-debits>$0.00</strong></article>
                <article class="notice">Credits: <strong data-journal-total-credits>$0.00</strong></article>
                <article class="notice">Difference: <strong data-journal-balance-diff>$0.00</strong></article>
            </div>

            <div class="data-row">
                <p class="value">
                    <span class="span-label"> </span>
                    <span class="span-actions">
                        <button type="button" id="journal_submit_button">Submit for Approval</button>
                        <button type="button" class="button-small" id="journal_reset_button">Reset</button>
                    </span>
                    
                </p>
            </div>
        </form>
    </section>
    <% } %> <% if (canViewJournalQueue) { %>
    <section class="card stack" aria-labelledby="journal_queue_title">
        <h2 id="journal_queue_title">Journal Queue</h2>
        <p class="meta">Review pending, approved, and rejected journal entries.</p>

        <div class="grid">
            <div class="field">
                <label for="queue_status_filter">Status</label>
                <select id="queue_status_filter" data-queue-status-filter>
                    <option value="pending" selected>Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                    <option value="all">All</option>
                </select>
            </div>
            <div class="field">
                <label for="queue_from_date">From Date</label>
                <input type="date" id="queue_from_date" data-queue-from-date />
            </div>
            <div class="field">
                <label for="queue_to_date">To Date</label>
                <input type="date" id="queue_to_date" data-queue-to-date />
            </div>
            <div class="field">
                <label for="queue_search">Search</label>
                <input type="search" id="queue_search" data-queue-search placeholder="Account, amount, or date" />
            </div>
        </div>

        <div class="data-row">
            <p class="value">
                <span class="span-label page-navigation">
                    Queue controls
                    <span class="inline-status" data-status>Updated --</span>
                </span>
                <span class="span-actions">
                    <button type="button" class="button-small" id="queue_apply_filters_button">Apply Filters</button>
                    <button type="button" class="button-small" id="queue_clear_filters_button">Clear</button>
                    <button type="button" class="button-small" data-refresh>Refresh Queue</button>
                </span>
            </p>
        </div>

        <div class="table-scroll">
            <table class="table table--wide" id="journal_queue_table">
                <thead>
                    <tr>
                        <th>Journal ID</th>
                        <th>Entry Date</th>
                        <th>Description</th>
                        <th>Prepared By</th>
                        <th>Total Debits</th>
                        <th>Total Credits</th>
                        <th>Status</th>
                        <th>Manager Comment</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody data-journal-queue>
                    <tr>
                        <td>JE-000124</td>
                        <td>2026-02-23</td>
                        <td>Customer payment received</td>
                        <td>acct_user</td>
                        <td>$2,500.00</td>
                        <td>$2,500.00</td>
                        <td><span class="badge">Pending</span></td>
                        <td class="meta">-</td>
                        <td>
                            <button type="button" class="button-small">View</button>
                            <% if (canApprove) { %>
                            <button type="button" class="button-small">Approve</button>
                            <button type="button" class="button-small">Reject</button>
                            <% } else { %>
                            <span class="meta">Manager approval required</span>
                            <% } %>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>
    <% } %> <% if (canViewLedger) { %>
    <section class="card stack" aria-labelledby="ledger_title">
        <h2 id="ledger_title">Ledger</h2>
        <p class="meta">Posted account activity with running balance and post-reference links to journals.</p>
        <% if (role === "administrator") { %>
        <p class="notice">Ledger is available in read-only mode for administrator users.</p>
        <% } %>

        <div class="grid">
            <div class="field">
                <label for="ledger_account_filter">Account</label>
                <select id="ledger_account_filter" data-ledger-account-filter>
                    <option value="all" selected>All Accounts</option>
                    <option value="cash">Cash</option>
                    <option value="accounts_receivable">Accounts Receivable</option>
                    <option value="sales_revenue">Sales Revenue</option>
                </select>
            </div>
            <div class="field">
                <label for="ledger_from_date">From Date</label>
                <input type="date" id="ledger_from_date" data-ledger-from-date />
            </div>
            <div class="field">
                <label for="ledger_to_date">To Date</label>
                <input type="date" id="ledger_to_date" data-ledger-to-date />
            </div>
            <div class="field">
                <label for="ledger_search">Search</label>
                <input type="search" id="ledger_search" data-ledger-search placeholder="Account or amount" />
            </div>
        </div>

        <div class="data-row">
            <p class="value">
                <span class="span-label page-navigation">Ledger View</span>
                <span class="span-actions">
                    <a id="ledger_trial_balance_link" class="account-transactions-link" href="#/reports?report=trial_balance&as_of=<%= encodeURIComponent(new Date().toISOString().slice(0, 10)) %>&from_date=<%= encodeURIComponent(new Date().toISOString().slice(0, 10)) %>&to_date=<%= encodeURIComponent(new Date().toISOString().slice(0, 10)) %>"> View Trial Balance as of today </a>
                </span>
                <span class="span-actions">
                    <button type="button" class="button-small" id="ledger_apply_filters_button">Apply Filters</button>
                    <button type="button" class="button-small" id="ledger_clear_filters_button">Clear</button>
                </span>
            </p>
        </div>

        <div class="table-scroll">
            <table class="table table--wide" id="ledger_table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Account</th>
                        <th>Description</th>
                        <th>Posting Ref</th>
                        <th>Debit</th>
                        <th>Credit</th>
                        <th>Balance</th>
                    </tr>
                </thead>
                <tbody data-ledger-rows>
                    <tr>
                        <td>2026-02-23</td>
                        <td>Cash</td>
                        <td>Customer payment received</td>
                        <td><a href="#/transactions?journal_id=124">JE-000124</a></td>
                        <td>$2,500.00</td>
                        <td>$0.00</td>
                        <td>$12,980.00</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="grid">
            <article class="card stack">
                <h2>T-Account (Debit)</h2>
                <div class="table-scroll">
                    <table class="table" id="t_account_debit_table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Posting Ref</th>
                                <th>Debit</th>
                            </tr>
                        </thead>
                        <tbody data-t-account-debit>
                            <tr>
                                <td>2026-02-23</td>
                                <td>JE-000124</td>
                                <td>$2,500.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </article>
            <article class="card stack">
                <h2>T-Account (Credit)</h2>
                <div class="table-scroll">
                    <table class="table" id="t_account_credit_table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Posting Ref</th>
                                <th>Credit</th>
                            </tr>
                        </thead>
                        <tbody data-t-account-credit>
                            <tr>
                                <td>2026-02-23</td>
                                <td>JE-000124</td>
                                <td>$0.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </article>
        </div>
    </section>
    <% } %>

    <% if (canJournalize) { %>
    <div id="journal_line_documents_modal" class="modal" aria-hidden="true">
        <div class="modal-content">
            <span class="close-button" id="close_journal_line_documents_modal" aria-label="Close">&times;</span>
            <h2 id="journal_line_documents_modal_title">Associate Documents to Journal Line</h2>
            <p class="meta" data-journal-line-documents-target-line>Line --</p>
            <form id="journal_line_documents_form" class="stack">
                <div id="journal_line_documents_checklist" data-journal-line-documents-checklist class="journal-line-documents-checklist">
                    <p class="meta">No documents available to associate.</p>
                </div>
                <div class="data-row">
                    <p class="value">
                        <span class="span-label"> </span>
                        <span class="span-actions">
                            <button type="button" class="button-small" id="journal_line_documents_cancel_button">Cancel</button>
                            <button type="submit" class="button-small" id="journal_line_documents_apply_button">Apply</button>
                        </span>
                    </p>
                </div>
            </form>
        </div>
    </div>
    <% } %>
</section>
