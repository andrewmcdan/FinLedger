<section class="page">
    <header class="page-header">
        <h1>Dashboard</h1>
        <p>Snapshot of balances and activity.</p>
    </header>
    <div class="grid">
        <article class="card">
            <h2>Cash on Hand</h2>
            <p class="value">$128,430</p>
            <p class="meta">Updated <span data-last-updated>--</span></p>
        </article>
        <article class="card">
            <h2>Payables</h2>
            <p class="value">$32,910</p>
            <p class="meta">Due this month</p>
        </article>
        <article class="card">
            <h2>Receivables</h2>
            <p class="value">$48,250</p>
            <p class="meta">Aging 30-60 days</p>
        </article>
    </div>
    <% 
    let usersWithPendingApprovalsLength = users.filter(user => user.status === 'pending').length;
    let usersWithSuspendedAccountsLength = users.filter(user => user.status === 'suspended').length;
    %>
    <% if (role === "administrator") { %>
    <section class="stack">
        <h2>User Management</h2>
        <div class="grid">
            
            <article class="card">
                <h2>User Approvals</h2>
                <% if (usersWithPendingApprovalsLength == 0) { %>
                <p class="meta">No pending user approvals</p>
                <% } %>
                <% users.filter(user => user.status === 'pending').forEach(user => { %>
                <article class="data-row">
                    <p class="value"><%= user.username %> <button onclick="(()=>{
                        // TODO: call the approve user endpoint
                    })()" class="button-small">Approve</button></p>
                    <p class="meta">Pending since <%= user.created_at %></p>
                </article>
                <% }); %>
            </article>
            <article class="card">
                <h2>Users with Expired Passwords</h2>
                <% if (users.filter(user => user.password_expired).length == 0) { %>
                <p class="meta">No users with expired passwords</p>
                <% } %>
                <% for (let user of users.filter(user => user.password_expires_at < new Date())) { %>
                <article class="data-row">
                    <p class="value"><%= user.username %> <button class="button-small">Suspend User</button></p>
                    <p class="meta">Password Expired on <%= user.password_expires_at %></p>
                </article>
                <% } %>
            </article>
        </div>
        <div class="grid">
            <article class="card">
                <h2>Suspended Users</h2>
                <% if (usersWithSuspendedAccountsLength == 0) { %>
                <p class="meta">No suspended user accounts</p>
                <% } %>
                <% users.filter(user => user.status === 'suspended').forEach(user => { %>
                <article class="data-row">
                    <p class="value"><%= user.username %></p>
                    <p class="meta">Ends <%= user.suspension_end_at %></p>
                </article>
                <% }); %>
            </article>
            <article class="card">
                <h2>Currently Logged-in Users</h2>
                <% if (loggedInUsers.length == 0) { %>
                <p class="meta">No users currently logged in</p>
                <% } %>
                <% loggedInUsers.forEach(user => { %>
                <article class="data-row">
                    <p class="value"><%
                        // get the username from the users array
                        let matchedUser = users.find(u => u.id === user.user_id);
                        if (matchedUser) {
                            %><%= matchedUser.username %><%
                        } else {
                            %>Unknown User<%
                        }
                        %></p>
                </article>
                <% }); %>
            </article>
        </div>
        <div class="grid">
            <article class="card">
                <h2>All Users</h2>
                <% users.forEach(user => { %>
                <article class="data-row">
                    <p class="value"><%= user.username %></p>
                </article>
                <% }); %>
            </article>
        </div>
    </section>
    <% } else { %>
    <section class="card">
        <h2>Your Workspace</h2>
        <p class="meta">Signed in as role: <%= role %></p>
        <div class="stack">
            <div class="notice">Your most recent transactions</div>
        </div>
    </section>
    <% } %>
</section>
