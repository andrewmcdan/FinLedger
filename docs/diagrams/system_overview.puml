@startuml
title FinLedger System Overview
skinparam componentStyle rectangle
skinparam packageStyle rectangle
skinparam shadowing false
left to right direction

actor "End User\n(Admin / Manager / Accountant)" as EndUser
actor "Anonymous Visitor" as Visitor

package "Client (Browser)" {
  [FinLedger SPA\nweb/index.html] as SPA
  [UI Assets\nweb/css + web/js] as Assets
  [Page Partials\nweb/pages/*.html] as Pages
}

package "Server (Node.js / Express)" {
  [Express App\nsrc/server.js] as Server
  [Auth Middleware\nsrc/middleware/auth.js] as AuthMW
  [Routes\nsrc/routes/*] as Routes
  [Controllers\nsrc/controllers/*] as Controllers
  [Utilities & Logger\nsrc/utils/*] as Utils
  [Email Service\nsrc/services/email.js] as EmailSvc
}

database "PostgreSQL" as DB
folder "User Icons\nuser-icons/" as Icons
folder "User Docs\nuser-docs/" as Docs
cloud "SMTP Server" as SMTP

package "Maintenance & Tests" {
  [DB Init\nscripts/init-db.js] as InitDB
  [DB Reset\nscripts/reset-db.js] as ResetDB
  [Tests\nnode:test] as Tests
}

EndUser --> SPA
Visitor --> SPA
SPA --> Server : HTML + JSON
SPA --> Pages : loads partials
SPA --> Assets : loads JS/CSS
Server --> DB : SQL
Server --> Icons : read/write
Server --> Docs : read/write
EmailSvc --> SMTP : SMTP

InitDB --> DB
ResetDB --> DB
ResetDB --> Icons
ResetDB --> Docs
Tests --> Server : HTTP
Tests --> DB

Server ..> AuthMW
Server ..> Routes
Routes ..> Controllers
Controllers ..> Utils
Controllers ..> EmailSvc
Utils ..> DB

note right of Server
Scheduled jobs (setInterval):
- logoutInactiveUsers
- unsuspendExpiredSuspensions
- sendPasswordExpiryWarnings
- suspendUsersWithExpiredPasswords
- cleanupUserData
- cleanupLogs
end note
@enduml
